<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chúc Mừng Năm Mới 2026 - Tết Bính Ngọ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Playfair+Display:wght@700&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- CẤU HÌNH MÀU SẮC & BIẾN --- */
        :root {
            --tet-red: #D20000;
            --tet-gold: #FFD700;
            --tet-dark: #0a0a0a;
            /* Luxury Variables */
            --gold-foil: linear-gradient(135deg, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            --red-paper: radial-gradient(circle at center, #D20000 0%, #900000 80%, #400000 100%);
            /* Màu Vàng Ảnh Cũ (Vintage Gold) cho bao cuối */
            --vintage-gold-paper: radial-gradient(circle at center, #FFD700 0%, #DAA520 60%, #B8860B 100%);
            --vintage-gold-flap: linear-gradient(135deg, #E6C200 0%, #B8860B 100%);
            --royal-red-seal: radial-gradient(circle at 30% 30%, #ff4d4d, #cc0000);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            background-color: #000;
            color: white;
            overflow: hidden; 
            min-height: 100vh;
            font-family: 'Montserrat', sans-serif;
            user-select: none; -webkit-user-select: none;
        }

        /* --- 1. ĐẾM NGƯỢC --- */
        #countdown-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, #200000 0%, #000000 80%);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 2000; transition: opacity 1.5s ease;
            overflow: hidden;
        }
        #countdown {
            font-size: 20vw; 
            font-weight: 900; font-family: 'Playfair Display', serif;
            background: linear-gradient(to bottom, #FFFFC2, #FFD700, #DAA520);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.4));
            position: relative;
            animation: intensePulse 0.8s infinite alternate;
        }
        @keyframes intensePulse {
            0% { transform: scale(1); filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.5)); }
            100% { transform: scale(1.05); filter: drop-shadow(0 0 50px rgba(255, 215, 0, 0.8)); }
        }

        .critical-count {
            animation: criticalFlash 0.3s infinite alternate !important;
            background: linear-gradient(to bottom, #ff9999, #ff0000, #8b0000) !important;
            -webkit-background-clip: text !important;
        }
        @keyframes criticalFlash {
            0% { opacity: 1; transform: scale(1.1); filter: drop-shadow(0 0 40px red); }
            100% { opacity: 0.8; transform: scale(1.2); filter: drop-shadow(0 0 70px red); }
        }

        .countdown-subtext {
            font-size: 4vw; 
            color: #FFA500; margin-top: 20px; letter-spacing: 2px;
            font-family: 'Dancing Script', cursive; text-align: center;
            text-shadow: 0 0 10px rgba(255, 165, 0, 0.5);
        }

        .screen-shake { animation: screenShake 0.2s infinite alternate; }
        @keyframes screenShake { 0% { transform: translate(-2px, -2px); } 100% { transform: translate(2px, 2px); } }

        .flip-digit { display: inline-block; animation: flip 0.5s ease-in-out; }
        @keyframes flip { 0% { transform: rotateX(0deg); } 50% { transform: rotateX(90deg); } 100% { transform: rotateX(0deg); } }

        /* --- 2. MÀN HÌNH PHÁO HOA --- */
        #fireworks-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, #050510 0%, #000000 100%);
            z-index: 1900;
            display: none;
        }
        #fireworks-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        .fireworks-text {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5rem;
            font-family: 'Dancing Script', cursive;
            text-align: center; z-index: 100; opacity: 0;
            background: linear-gradient(45deg, #ff0000, #ff7300, #fffb00, #48ff00, #00ffd5, #002bff, #7a00ff, #ff00c8, #ff0000);
            background-size: 400%;
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: fadeInOut 5s ease-in-out forwards, rainbow 10s linear infinite;
        }
        @keyframes rainbow { 0% {background-position: 0%;} 100% {background-position: 400%;} }
        @keyframes fadeInOut { 0% {opacity:0; transform:translate(-50%,-50%) scale(0.5);} 20%,80% {opacity:1; transform:translate(-50%,-50%) scale(1);} 100% {opacity:0; transform:translate(-50%,-50%) scale(1.2);} }

        /* --- 3. LUXURY ENVELOPE STYLES --- */
        @keyframes goldShimmer {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }

        @keyframes sealPulse {
            0% { transform: translate(-50%, -50%) scale(1); box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); }
            70% { transform: translate(-50%, -50%) scale(1.1); box-shadow: 0 0 20px 10px rgba(255, 215, 0, 0); }
            100% { transform: translate(-50%, -50%) scale(1); box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
        }

        /* Style chung cho bao lì xì */
        .luxury-envelope {
            width: 220px; height: 320px;
            background: var(--red-paper);
            border-radius: 10px;
            position: relative;
            box-shadow: 0 20px 50px rgba(0,0,0,0.6), inset 0 0 30px rgba(0,0,0,0.5);
            border: 2px solid #b38728;
            transform-style: preserve-3d;
            cursor: pointer;
            overflow: visible;
        }

        .luxury-envelope::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: radial-gradient(#ffd700 15%, transparent 16%), radial-gradient(#ffd700 15%, transparent 16%);
            background-size: 30px 30px; background-position: 0 0, 15px 15px;
            opacity: 0.1; pointer-events: none; border-radius: 8px;
        }

        .luxury-flap {
            position: absolute; top: 0; left: 0; width: 100%; height: 40%;
            background: var(--red-paper);
            clip-path: polygon(0 0, 100% 0, 50% 100%);
            transform-origin: top; z-index: 5;
            transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            border-top: 3px solid #b38728;
        }
        .luxury-flap::after {
            content: ''; position: absolute; top: -5px; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(255,215,0,0.2), transparent);
            pointer-events: none;
        }

        .gold-seal {
            position: absolute; top: 38%; left: 50%;
            width: 70px; height: 70px;
            background: var(--gold-foil);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 6;
            display: flex; justify-content: center; align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
            border: 2px solid #fcf6ba;
            transition: all 0.5s ease;
            animation: sealPulse 2s infinite;
        }
        .gold-seal::before {
            content: 'Tết';
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem; font-weight: bold;
            color: #8B0000; text-shadow: 0 1px 0 rgba(255,255,255,0.4);
        }

        .envelope-face {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: flex-end; align-items: center;
            padding-bottom: 40px; z-index: 2;
        }

        .decorative-band {
            width: 65%; height: 140px;
            border: 2px solid rgba(255, 215, 0, 0.4);
            display: flex; justify-content: center; align-items: center;
            margin-bottom: 20px; position: relative;
        }
        .decorative-text {
            font-family: 'Dancing Script', cursive; font-size: 2.5rem;
            background: var(--gold-foil); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.5));
        }

        /* --- OVERRIDE RIÊNG CHO BAO LÌ XÌ CUỐI CÙNG (VINTAGE GOLD) --- */
        #final-envelope {
            background: var(--vintage-gold-paper) !important;
            border-color: #fff !important;
            box-shadow: 0 0 80px rgba(255, 215, 0, 0.6) !important;
        }

        #final-envelope .luxury-flap {
            background: var(--vintage-gold-flap) !important;
            border-top: 3px solid #fff;
        }

        #final-envelope .gold-seal {
            background: var(--royal-red-seal) !important;
            border: 2px solid #FFD700 !important;
            box-shadow: 0 5px 20px rgba(139, 0, 0, 0.4);
        }
        #final-envelope .gold-seal::before {
            color: #FFD700 !important;
        }

        #final-envelope .decorative-band {
            border-color: #8B0000 !important;
        }
        #final-envelope .decorative-text {
            background: none !important;
            -webkit-text-fill-color: #8B0000 !important;
            text-shadow: 0 1px 1px rgba(255,255,255,0.3);
        }
        #final-envelope .click-hint {
            color: #8B0000 !important;
            text-shadow: none !important;
        }

        /* States */
        .luxury-envelope.open .luxury-flap { transform: rotateX(180deg); z-index: 0; }
        .luxury-envelope.open .gold-seal { opacity: 0; transform: translate(-50%, -150%) scale(0); }

        /* Screen Specifics */
        #intro-envelope-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1850; display: none;
            justify-content: center; align-items: center; flex-direction: column;
            background: radial-gradient(circle, #500000 0%, #200000 100%);
            opacity: 0; transition: opacity 1s ease;
        }

        .intro-instruction {
            color: #FFD700; font-family: 'Dancing Script', cursive; font-size: 2.5rem; margin-bottom: 40px;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.8); 
            opacity: 0; transform: translateY(20px); transition: all 1s ease;
        }
        .intro-instruction.show { opacity: 1; transform: translateY(0); }

        #intro-envelope {
            opacity: 0; transform: translateY(100vh) scale(0.8) rotate(5deg);
            transition: all 1.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        #intro-envelope.visible {
            opacity: 1; transform: translateY(0) scale(1) rotate(0deg);
            animation: floatEnvelope 3s ease-in-out infinite 1.5s;
        }
        @keyframes floatEnvelope { 0%,100% {transform:translateY(0) rotate(0deg);} 50% {transform:translateY(-20px) rotate(2deg);} }

        .envelope-light {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 400px; height: 400px;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.4) 0%, rgba(255, 0, 0, 0) 70%);
            z-index: -1; opacity: 0; transition: opacity 1s ease;
        }
        #intro-envelope.visible ~ .envelope-light { opacity: 0.8; animation: pulseLight 3s ease-in-out infinite; }
        @keyframes pulseLight { 0%,100% {opacity:0.5; transform:translate(-50%,-50%) scale(1);} 50% {opacity:0.8; transform:translate(-50%,-50%) scale(1.2);} }

        /* --- 4. FORM NHẬP THÔNG TIN --- */
        #input-form-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #500000 0%, #1a0000 100%);
            z-index: 1800; display: none;
            flex-direction: column; justify-content: center; align-items: center;
            padding: 20px; opacity: 0; transition: opacity 1s ease;
        }
        .form-container {
            background: rgba(80, 0, 0, 0.6);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 20px;
            padding: 40px 30px; width: 100%; max-width: 500px;
            box-shadow: 0 0 50px rgba(255, 0, 0, 0.4); text-align: center;
        }
        .form-title { font-family: 'Dancing Script', cursive; font-size: 3rem; color: #FFD700; margin-bottom: 30px; }
        .input-group { margin-bottom: 25px; text-align: left; }
        .input-label { display: block; color: #FFD700; margin-bottom: 8px; font-size: 1.1rem; }
        .form-input, .form-select {
            width: 100%; padding: 15px; background: rgba(0, 0, 0, 0.3);
            border: 1px solid #FFD700; border-radius: 10px; color: white;
            font-size: 1rem; outline: none; transition: all 0.3s;
        }
        .form-input:focus { background: rgba(50, 0, 0, 0.5); box-shadow: 0 0 15px rgba(255, 215, 0, 0.4); }
        .submit-btn {
            background: linear-gradient(to right, #DAA520, #FFD700, #DAA520);
            background-size: 200%;
            color: #800000; border: none; padding: 15px 40px;
            border-radius: 50px; font-size: 1.2rem; font-weight: bold;
            cursor: pointer; margin-top: 20px; width: 100%; transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(218, 165, 32, 0.3);
        }
        .submit-btn:hover { background-position: right center; transform: scale(1.02); }
        .error-message { color: #FF6B6B; margin-top: 10px; font-size: 0.9rem; display: none; }
        .hint-text { color: #ccc; font-size: 0.8rem; margin-bottom: 20px; font-style: italic; }

        /* --- 5. TRANSITION & SLIDESHOW --- */
        #transition-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #200000; z-index: 1700;
            display: none; justify-content: center; align-items: center; padding: 20px;
        }
        #transition-text {
            font-family: 'Playfair Display', serif; font-size: 2.5rem; color: #FFD700;
            text-align: center; line-height: 1.4;
            text-shadow: 0 0 20px rgba(218, 165, 32, 0.5);
        }
        .cursor { display: inline-block; width: 3px; height: 1em; background-color: #FFD700; animation: blinkCursor 0.8s infinite; vertical-align: bottom; margin-left: 2px; }
        @keyframes blinkCursor { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        #slideshow-screen {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, #3d0000 0%, #150000 100%);
            z-index: 1000; justify-content: center; align-items: center; flex-direction: column;
        }
        .slide-image-container { position: relative; width: 90%; max-width: 600px; height: 60vh; display: flex; justify-content: center; align-items: center; }
        .slide-img {
            max-width: 100%; max-height: 100%; border-radius: 15px;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3); border: 2px solid #FFD700;
            opacity: 0; position: absolute; transition: all 1.5s ease-in-out; transform: scale(0.9);
        }
        .slide-img.active { opacity: 1; transform: scale(1); }
        .slide-caption {
            margin-top: 20px; font-size: 2rem; color: #FFD700; text-align: center;
            font-family: 'Dancing Script', cursive; opacity: 0; transition: opacity 1s ease;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        }

        /* --- 6. FINAL SCREEN & SATELLITES --- */
        #final-screen {
            display: none; width: 100%; height: 100vh;
            background: radial-gradient(circle at center, #500000 0%, #2b0000 50%, #100000 100%);
            position: relative; overflow: hidden; z-index: 10;
        }
        #final-screen::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                radial-gradient(white, rgba(255,255,255,.2) 2px, transparent 3px),
                radial-gradient(white, rgba(255,255,255,.15) 1px, transparent 2px);
            background-size: 550px 550px, 350px 350px;
            animation: starMove 100s linear infinite; opacity: 0.6; z-index: 1;
        }
        @keyframes starMove { from { transform: translateY(0); } to { transform: translateY(-1000px); } }

        .halo-ring {
            position: absolute; top: 50%; left: 50%; width: 320px; height: 320px;
            transform: translate(-50%, -50%); border: 2px dashed rgba(255, 215, 0, 0.3);
            border-radius: 50%; animation: rotateHalo 30s linear infinite; pointer-events: none; z-index: 15;
        }
        .halo-ring::after {
            content: ''; position: absolute; top: -8px; left: 50%; transform: translateX(-50%);
            width: 16px; height: 16px; background: #FFD700; border-radius: 50%; box-shadow: 0 0 20px #FFD700;
        }
        @keyframes rotateHalo { from { transform: translate(-50%, -50%) rotate(0deg); } to { transform: translate(-50%, -50%) rotate(360deg); } }

        #center-stage {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 0; height: 0; z-index: 20; display: flex; justify-content: center; align-items: center;
        }
        #final-envelope-container {
            position: absolute; 
            z-index: 100; 
            width: 220px; height: 320px; perspective: 1000px;
            opacity: 0; transform: scale(0); transition: all 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #final-envelope-container.show { opacity: 1; transform: scale(1); }

        /* --- VỆ TINH: ẢNH TO RÕ --- */
        .satellite-item {
            position: absolute;
            width: 100px; height: 100px; 
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.3);
            border: 3px solid rgba(255, 215, 0, 0.9);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
            display: flex; justify-content: center; align-items: center;
            pointer-events: none; 
            z-index: 20;
            transform-style: preserve-3d;
            will-change: transform, z-index, opacity;
        }

        .satellite-item::before { content: none; }

        .satellite-item::after {
            content: ''; position: absolute; 
            top: -8px; left: -8px; right: -8px; bottom: -8px;
            border-radius: 50%;
            border: 1px dashed rgba(255, 215, 0, 0.4);
            animation: spinSatelliteRing 20s linear infinite;
        }
        @keyframes spinSatelliteRing { from {transform: rotate(0deg);} to {transform: rotate(360deg);} }

        .satellite-item img {
            width: 100%; height: 100%;
            border-radius: 50%; 
            object-fit: cover;
            z-index: 2;
        }

        .final-title-text {
            position: absolute; top: 10%; width: 100%; text-align: center;
            font-size: 3rem; font-family: 'Playfair Display', serif;
            background: linear-gradient(to right, #FFD700, #FFFACD, #DAA520);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 15px rgba(255, 0, 0, 0.8));
            z-index: 30; opacity: 0; animation: fadeIn 2s forwards 1s;
            letter-spacing: 2px; padding: 0 10px;
        }
        @keyframes fadeIn { to { opacity: 1; } }

        /* --- 7. MODAL LÌ XÌ LUXURY --- */
        #red-envelope-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, #a00000 0%, #600000 70%, #200000 100%);
            z-index: 3000;
            display: none; justify-content: center; align-items: center;
            backdrop-filter: blur(5px); perspective: 1500px; padding: 20px;
        }

        .god-rays {
            position: absolute; width: 150vmax; height: 150vmax;
            background: repeating-conic-gradient(from 0deg, rgba(255, 215, 0, 0.25) 0deg 10deg, transparent 10deg 20deg);
            animation: rotateRays 30s linear infinite; z-index: -1; pointer-events: none;
            mix-blend-mode: overlay;
        }
        @keyframes rotateRays { to { transform: rotate(360deg); } }

        .luxury-card {
            width: 100%; max-width: 400px; padding: 3px; 
            background: linear-gradient(135deg, #bf953f, #fcf6ba, #bf953f);
            border-radius: 25px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6), 0 0 80px rgba(255, 69, 0, 0.5);
            animation: openCard 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); position: relative;
        }
        @keyframes openCard { 0% { transform: scale(0.6); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

        .luxury-inner {
            background: radial-gradient(circle, #800000 0%, #300000 100%);
            border-radius: 20px; padding: 30px 20px;
            display: flex; flex-direction: column; align-items: center;
            border: 1px solid rgba(255, 215, 0, 0.2); position: relative; overflow: hidden;
        }
        .luxury-inner::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: radial-gradient(circle, rgba(255,215,0,0.1) 2px, transparent 3px);
            background-size: 20px 20px; opacity: 0.5; pointer-events: none;
        }

        .luxury-avatar {
            width: 110px; height: 110px; border-radius: 50%;
            border: 3px double #FFD700; box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            padding: 2px; background: radial-gradient(circle, #ffd700, #ffaa00); margin-bottom: 20px; z-index: 2;
        }
        .luxury-avatar img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }
        .gold-text {
            font-family: 'Dancing Script', cursive; font-size: 2.5rem;
            background: linear-gradient(to bottom, #FFD700, #FFFACD, #DAA520);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 2px 0px rgba(0,0,0,0.5)); margin-bottom: 10px; text-align: center; z-index: 2;
        }
        .wishes-text {
            color: #fff; font-size: 1.1rem; line-height: 1.6; text-align: center; margin-bottom: 25px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5); font-weight: 500; z-index: 2;
        }
        .qr-frame {
            padding: 10px; background: rgba(255,255,255,0.15);
            border: 2px solid #FFD700; border-radius: 12px; margin-bottom: 25px; z-index: 2;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
        }
        .qr-frame img { display: block; border-radius: 5px; width: 140px; height: 140px; }
        .royal-btn {
            background: linear-gradient(90deg, #d4af37, #f7ef8a, #d4af37);
            background-size: 200% auto;
            animation: goldShimmer 3s linear infinite;
            color: #500000; font-weight: 900; border: none; width: 100%;
            padding: 16px 0; border-radius: 50px; cursor: pointer; z-index: 2;
            font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.4); transition: transform 0.2s;
            text-shadow: 0 1px 0 rgba(255,255,255,0.4);
        }
        .royal-btn:active { transform: scale(0.95); }
        .royal-btn:hover { background-position: right center; }

        /* HỆ THỐNG HẠT & MUSIC */
        .particle-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; }
        .burst-particle { position: absolute; border-radius: 50%; pointer-events: none; }
        .gold-dust {
            position: absolute; width: 5px; height: 5px; background: #FFD700; border-radius: 50%;
            animation: fall 3s linear forwards; pointer-events: none;
            box-shadow: 0 0 5px #FFD700;
        }
        @keyframes fall { to { transform: translateY(600px) rotate(360deg); } }

        .music-btn {
            position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px;
            border-radius: 50%; background: rgba(255, 0, 0, 0.8); border: 2px solid #FFD700; 
            cursor: pointer; z-index: 5000;
            display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: #FFD700;
            animation: spin 5s linear infinite; box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
            touch-action: manipulation; 
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* --- 8. HIỆU ỨNG TIỀN RƠI (MONEY RAIN) --- */
        .falling-money {
            position: fixed; top: -100px;
            z-index: 9999;
            pointer-events: none;
            animation-name: moneyFall;
            animation-timing-function: linear;
            animation-fill-mode: forwards;
        }

        /* Tiền giấy (Giả lập Polymer) */
        .money-bill {
            width: 80px; height: 35px;
            /* Dùng link ảnh 500k hoặc fallback màu xanh nếu lỗi */
            background-color: #85bb65; 
            background-image: url('https://upload.wikimedia.org/wikipedia/vi/1/1c/500000_VND_polymer_back.jpg');
            background-size: cover; background-position: center;
            border: 1px solid rgba(255,255,255,0.5);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            border-radius: 2px;
        }

        /* Đồng xu vàng */
        .money-coin {
            width: 30px; height: 30px;
            background: radial-gradient(circle at 30% 30%, #FFD700, #DAA520);
            border: 2px solid #FFFACD;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
            display: flex; justify-content: center; align-items: center;
            font-weight: bold; color: #B8860B; font-size: 12px;
        }
        .money-coin::after { content: '$'; }

        /* Animation rơi xoay vòng */
        @keyframes moneyFall {
            0% { transform: translateY(0) rotateX(0deg) rotateY(0deg) rotateZ(0deg); opacity: 1; }
            80% { opacity: 1; }
            100% { transform: translateY(110vh) rotateX(720deg) rotateY(360deg) rotateZ(180deg); opacity: 0; }
        }
    </style>
</head>

<body class="no-scroll">
    <div class="particle-container" id="global-particles"></div>

    <div id="countdown-screen">
        <div id="start-hint" style="font-size: 1.5rem; color: #fff; margin-bottom: 20px; animation: blink 1s infinite;">
            <i class="fas fa-hand-pointer"></i> (Chạm màn hình để bắt đầu)
        </div>
        <div id="countdown">10</div>
        <div class="countdown-subtext">Thời Khắc Giao Thừa</div>
    </div>

    <div id="fireworks-screen">
        <canvas id="fireworks-canvas"></canvas>
        <div class="fireworks-text">Chúc Mừng<br>Năm Mới 2026!</div>
    </div>

    <div id="intro-envelope-screen">
        <div class="intro-instruction" id="intro-inst">Lộc Xuân Gõ Cửa</div>
        <div class="envelope-light"></div>

        <div id="intro-envelope" class="luxury-envelope">
            <div class="luxury-flap"></div>
            <div class="gold-seal"></div>
            <div class="envelope-face">
                <div class="decorative-band">
                    <div class="decorative-text">Xuân 2026</div>
                </div>
                <div style="color: #FFD700; font-size: 0.9rem; letter-spacing: 2px; text-shadow: 0 1px 2px rgba(0,0,0,0.5);">
                    BẤM ĐỂ MỞ</div>
            </div>
        </div>
    </div>

    <div id="input-form-screen">
        <div class="form-container">
            <h1 class="form-title">Nhận Lộc Xuân</h1>
            <div class="hint-text">Điền đầy đủ thông tin để nhận Lộc Xuân (Mock: Mẹ/Mother/19/01/1981)</div>
            
            <div class="input-group">
                <label class="input-label" for="user-name">Họ và tên:</label>
                <input type="text" id="user-name" class="form-input" placeholder="Nhập họ và tên của bạn">
                <div class="error-message" id="name-error">Vui lòng nhập họ và tên hợp lệ</div>
            </div>

            <div class="input-group">
                <label class="input-label" for="user-gender">Giới tính:</label>
                <select id="user-gender" class="form-select">
                    <option value="" disabled selected>Chọn giới tính</option>
                    <option value="nam">Nam</option>
                    <option value="nu">Nữ</option>
                </select>
                <div class="error-message" id="gender-error">Vui lòng chọn giới tính</div>
            </div>

            <div class="input-group">
                <label class="input-label" for="user-role">Mối quan hệ với Đạt:</label>
                <select id="user-role" class="form-select">
                    <option value="" disabled selected>Chọn mối quan hệ với Đạt</option>
                    <option value="Mother">Mẹ</option>
                    <option value="elder sister">Chị Gái</option>
                    <option value="Grandfather">Ông</option>
                    <option value="brother">Anh/Em</option>
                    <option value="brother_stress">Anh em (Stress)</option>
                    <option value="Friends">Bạn Bè</option>
                </select>
                <div class="error-message" id="role-error">Vui lòng chọn lại mối quan hệ</div>
            </div>

            <div class="input-group">
                <label class="input-label" for="user-birthday">Nhập ngày tháng năm sinh (dd/mm/yyyy):</label>
                <input type="text" id="user-birthday" class="form-input" placeholder="Ví dụ: 19/01/1981">
                <div class="error-message" id="birthday-error">Vui lòng nhập đúng định dạng (vd: 15/01/2000)</div>
            </div>

            <button class="submit-btn" id="submit-info">Xác Nhận</button>
            <div class="error-message" id="general-error"></div>
        </div>
    </div>

    <div id="transition-screen">
        <div id="transition-text"></div>
    </div>

    <div id="slideshow-screen">
        <div class="slide-image-container" id="slide-container"></div>
        <div class="slide-caption" id="slide-caption"></div>
    </div>

    <div id="final-screen">
        <h1 class="final-title-text">Vạn Sự Như Ý 2026</h1>
        <div class="halo-ring"></div>
        <div id="center-stage">
            <div id="final-envelope-container">
                <div id="final-envelope" class="luxury-envelope">
                    <div class="luxury-flap" style="height: 55%; z-index: 10;"></div>
                    <div class="gold-seal" style="width: 90px; height: 90px; top: 40%;"></div>
                    <div class="envelope-face">
                        <div class="decorative-band" style="width: 70%; height: 160px;">
                            <div class="decorative-text" style="font-size: 3rem;">Phát Tài</div>
                        </div>
                        <div class="click-hint" style="color: #fff; font-weight: bold; animation: blink 1s infinite; text-shadow: 0 1px 2px rgba(0,0,0,0.5);">
                            (Nhấn để nhận lộc)</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="red-envelope-screen">
        <div class="god-rays"></div>
        <div id="modal-particles" style="position: absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; overflow: hidden;">
        </div>

        <div class="luxury-card">
            <div class="luxury-inner">
                <div class="luxury-avatar">
                    <img id="final-avatar" src="https://ui-avatars.com/api/?name=Than+Tai&background=random" alt="Thần Tài">
                </div>
                <h2 class="gold-text">Tấn Tài Tấn Lộc</h2>
                <p class="wishes-text" id="personal-wishes"></p>
                <div class="qr-frame">
                    <img id="final-qr" src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=ChucMungNamMoi" alt="QR Code">
                </div>
                <button class="royal-btn" onclick="closeModal()">Nhận Lộc Ngay</button>
            </div>
        </div>
    </div>  

    <button class="music-btn" id="music-toggle"><i class="fas fa-music"></i></button>
    <audio id="bg-music">
        <source src="Music/time.mp3" type="audio/mpeg">
    </audio>
    <audio id="open-sound" src="https://assets.mixkit.co/active_storage/sfx/2014/2014-preview.mp3"></audio>
    <audio id="burst-sound" src="https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3"></audio>

    <script>
    // --- 1. KHO NỘI DUNG CÁ NHÂN HÓA (GIỮ NGUYÊN TÊN BIẾN CỦA BẠN) ---
    const brothersInVillage = {
        "An": "Chúc mày có 1 năm mới thật nhiều sức khỏe, niềm vui ngập tràn, mọi dự định sẽ đều suôn sẻ và thành công.Mong rằng trong năm tới a và chú sẽ có thật nhiều kỉ niệm đẹp bên nhau!",
        "Huy": "Chúc mày năm mới vạn sự như ý, sức khỏe vô biên, tiền vào như nước sông đà, chảy ra như giọt cafe phin.Mong bạn luôn bình an, khỏe mạnh , sống đúng với điều mà bản thân mình mong muốn.Mong rằng trong năm tới chúng ta sẽ có thật nhiều kỉ niệm đẹp bên nhau!",
        "Cường": "Chúc ô a Cường năm mới thật nhiều sức khỏe, tiền vào như nước sông đà, chảy ra như giọt cafe phin.Chúc anh có 1 năm mới thật rực rỡ như hành trình của e nè haha.Mong rằng anh em ta sẽ có 1 năm mới thật nhiều kỉ niệm đẹp bên nhau!",
        "Hải": "Năm mới a chúc Hải 'Chân cứng đá mềm', biến những trải nghiệm trường đời sớm thành vốn sống quý giá. Tết là để về nhà, mong năm nay công việc hanh thông, ví dày, tâm an, để mỗi lần tụ họp vẫn luôn cười tươi rói nhé.Mong rằng anh em ta năm mới sẽ có thật nhiều kỉ niệm bên nhau!",
        "Hoàng": "Chúc Hoàng năm mới rực rỡ. 18 tuổi, người ta còn lo trang sách, em đã lo được nồi cơm, cái bản lĩnh ấy anh nể. Nhưng IT là đường đua khắc nghiệt, chúc em năm nay:Tối ưu hóa cuộc sống. Không có bằng cấp thì mình phải dùng đẳng cấp để nói chuyện. Kiếm tiền giỏi rồi, giờ nhớ giữ gìn sức khỏe và nâng cấp bản thân liên tục để không bao giờ bị tụt hậu nhé.Mong rằng anh em ta sang năm mới sẽ có thật nhiều kỉ niệm đáng nhớ trong năm mới!",
        "Hưng": "Năm mới Tết đến, tao trân trọng đề nghị mày năm nay bớt 'ngáo', bớt 'báo' lại giùm tao cái. Chúc mày năm 2026 nhan sắc thăng hạng (để sớm lừa được em nào về ra mắt mẹ), tài khoản thì lúc nào cũng ting ting (để tao còn vay nóng lúc cần).Đi làm thì mong mày gặp được sếp hiền như Bụt, đồng nghiệp như tiên, deadline thì tự nhiên biến mất. Ra đường thì xe cộ cẩn thận, đừng có phóng nhanh vượt ẩu rồi lại báo gia đình. Nhậu nhẹt thì uống vừa thôi, gan ruột nó cũng có hạn sử dụng đấy con ạ.Chốt lại: Chúc mày năm mới 8386 (phát tài phát lộc), sớm thành đại gia để bao tao đi massage xông hơi. Happy New Year tml (thằng mặt lợn)!"
    };

    const contentDatabase = {
        "Mother": {
            music: "Music/tetme.mp3",
            images: [
                { url: 'https://images.unsplash.com/photo-1498050108023-c5249f4df085?w=600', caption: 'Mẹ yêu' },
                { url: 'https://images.unsplash.com/photo-1555066931-4365d14bab8c?w=600', caption: 'Gia đình' },
                { url: 'https://images.unsplash.com/photo-1517694712202-14dd9538aa97?w=600', caption: 'Hạnh phúc' }
            ],
            wishTemplate: "Chúc mẹ {name} bước sang tuổi {age} luôn mạnh khỏe, vui vẻ bên con cháu. Cảm ơn mẹ đã luôn là chỗ dựa vững chắc cho con!"
        },
        "elder sister": {
            music: "https://www.bensound.com/bensound-music/bensound-slowmotion.mp3",
            images: [
                { url: 'Image/elder_sister/anh1.jpg', caption: 'Chị gái' },
                { url: 'Image/elder_sister/anh2.jpg', caption: 'Kỷ niệm' },
                { url: 'Image/elder_sister/anh3.jpg', caption: 'Vui vẻ' },
                { url: 'Image/elder_sister/anh4.jpg', caption: 'Xinh đẹp' },
                { url: 'Image/elder_sister/anh5.jpg', caption: 'Hạnh phúc' },
                { url: 'Image/elder_sister/anh7.jpg', caption: 'Thành công' },
            ],
            wishTemplate: "Chúc {name} một năm 2026 ngập tràn ý tưởng, thiết kế nào cũng là tuyệt phẩm, khách hàng duyệt layout trong một nốt nhạc!"
        },
        "Grandfather": {
            music: "Music/tetbinhan.mp3",
            images: [
                { url: 'Image/grandfather/anh1.jpg', caption: 'Cao Bồi Miền Tây' },
                { url: 'Image/grandfather/anh2.jpg', caption: 'Trùm Cuối Xuất Hiện' },
                { url: 'Image/grandfather/anh3.jpg', caption: 'Lên Đồ, Hế Lâuu' },
                { url: 'Image/grandfather/anh4.jpg', caption: 'Mùa Đông Không Lạnh' },
                { url: 'Image/grandfather/anh5.jpg', caption: 'Đọ Dáng-Khỏe Mạnh' },
                { url: 'Image/grandfather/anh6.jpg', caption: 'Du Xuân' },
                { url: 'Image/grandfather/anh7.jpg', caption: 'Yêu Đời' },
            ],
            wishTemplate: "Chúc ông {name} và gia đình có một năm mới thật là nhiều sức khỏe, luôn vui vẻ, yêu đời. Ông cố gắng giữ gìn sức khỏe để ông cháu ta còn đi phượt Bắc Nam nha!",
            avatar: "Image/grandfather/avt.jpg",
            qr: "Image/grandfather/QR.png",
        },
        "brother_village": {
            music: "Music/anhem.mp3",
            images: [
                { url: 'Image/brother_stress/anh0.jpg', caption: 'Thời đi phát lộc' },
                { url: 'Image/brother_stress/anhdiboi.jpg', caption: 'Sóng gió phủ đời trai' },
                { url: 'Image/brother_stress/dichoi.jpg', caption: 'Biệt đội báo thủ' },
                { url: 'Image/brother_stress/anhdangdayhoc.jpg', caption: 'Học hành' },
                { url: 'Image/brother_stress/an1.jpg', caption: 'Lẩu Nóng' },
                { url: 'Image/brother_stress/an2.jpg', caption: 'Quẩy' },
                { url: 'Image/brother_stress/an3.jpg', caption: 'Anh em mãi đỉnh' },
                { url: 'Image/brother_stress/an4.jpg', caption: 'No Say' },
                { url: 'Image/brother_stress/anh5.jpg', caption: 'Sinh nhật bạn Huy' },
                { url: 'Image/brother_stress/anh8.jpg', caption: 'Đi tìm bình yên' },
                { url: 'Image/brother_stress/anh6.jpg', caption: 'Bỏ phố về rừng' },
                { url: 'Image/brother_stress/anh7.jpg', caption: 'Gác lại lo âu' },
            ]
        },
        "brother_school": {
            music: "Music/brother.mp3",
            images: [
                { url: 'Image/brother/Datt.jpg', caption: 'Đẹp trai ' },
                { url: 'Image/brother/Tung.jpg', caption: 'Bựa nhất' },
                { url: 'Image/brother/Duc.jpg', caption: 'Hát hay' },
                { url: 'Image/brother/Hien.jpg', caption: 'Lẩn lâu-đang gãi nách' },
                { url: 'Image/brother/Tung2.jpg', caption: 'Bình thân miễn lễ' },
            ]
        }
    };

    // --- HÀM LẤY LỜI CHÚC (Đã sửa để dùng biến brothersInVillage & thêm GENDER) ---
    function getWish(name, age, vaiVe = "thap", gender = "nam") {
        // 1. Kiểm tra lời chúc riêng trong biến brothersInVillage
        if (brothersInVillage[name]) {
            return brothersInVillage[name];
        }
        // 3. Tính tuổi
        const myBirthYear = 2006;
        const currentYear = new Date().getFullYear();
        const friendBirthYear = currentYear - age;

        // 3.1 XỬ LÝ DANH XƯNG (ANH/CHỊ) DỰA VÀO GENDER
        let danhXung = (gender === "nu") ? "Chị" : "Anh";

        // --- LOGIC CHO NGƯỜI LỚN TUỔI HƠN (Sinh trước 2006) - Phiên bản "CHẠM ĐÁY TIM" ---
        if (friendBirthYear < myBirthYear) {
            const touchingWishes = [
                // CÂU 1: Đánh vào sự "gồng gánh" của người lớn
                `Gửi ${danhXung} ${name}: Người lớn thường ít khi được hỏi 'có mệt không'. Năm mới, em không chúc giàu sang phú quý, chỉ mong ${danhXung} mỗi tối về nhà đều trút bỏ được gánh nặng ngoài kia, ngủ một giấc thật ngon và thương bản thân mình nhiều hơn chút nữa.`,
                
                // CÂU 2: Chúc sự cân bằng (Ra đường vs Về nhà)
                `Chúc ${danhXung} ${name} năm mới: Ra đường là 'cá chép hóa rồng' hô mưa gọi gió, nhưng về nhà được làm 'mèo lười' thảnh thơi sưởi nắng. Mạnh mẽ đủ rồi, năm nay hãy cho phép mình được yếu mềm và tận hưởng thành quả nhé!`,
                
                // CÂU 3: Chúc về giá trị thời gian (Sống chậm)
                `Năm tháng vội vã, em chỉ chúc ${danhXung} ${name} sống chậm lại một nhịp. Ăn bữa cơm ngon, uống tách trà ấm. Tiền bạc là phương tiện, sự bình an trong tâm hồn mới là đích đến cuối cùng.`,
                
                // CÂU 4: Sự biết ơn sâu sắc (Dành cho người anh/chị hay giúp đỡ)
                `Cảm ơn ${danhXung} ${name} đã luôn là bóng cây lớn che chở cho mấy đứa em. Năm nay, chúc 'cây đại thụ' ấy mãi xanh tươi, gốc rễ vững bền, nhưng cũng đón nhận được thật nhiều ánh nắng ấm áp và yêu thương nhất.`,
                
                // CÂU 5: Chúc sự "Đủ" (Tri túc)
                `Chúc ${danhXung} ${name} một năm mới Vừa Đủ: Đủ sức khỏe để đi xa, Đủ bản lĩnh để vượt khó, Đủ tiền bạc để an tâm, và Đủ tình thương để thấy đời này thật đáng sống.`
            ];
            // Chọn ngẫu nhiên 1 câu "xuất sắc"
            return touchingWishes[Math.floor(Math.random() * touchingWishes.length)];
        }
        else if (friendBirthYear === myBirthYear) {
            return `Chúc bạn hiền ${name} năm mới vạn sự như ý, Tuổi 20 rực rỡ! Chúc mày vững vàng mục tiêu, đánh đâu thắng đó, sớm tự chủ tài chính để chúng ta sớm có thể đi du lịch xa một chuyến!`;
        }
        else {
            return `Năm mới Chúc ${name} chân cứng đá mềm giữa dòng đời, nhưng về nhà vẫn là đứa con hiếu thảo. Thành công không cần quá ồn ào, chỉ cần em sống bản lĩnh, tử tế và tìm thấy sự bình yên trong chính mình.Mong rằng trong năm mới chúng ta có thật nhiều kỉ niệm bên nhau!`;
        }
    }

    // --- HÀM XỬ LÝ CHECK USER (Đã update: Xử lý người lạ -> Hiện Thần Tài + CÓ GENDER) ---
    function checkUserInDatabase() {
        const generalError = document.getElementById('general-error');
        const submitBtn = document.getElementById('submit-info');
        const originalText = submitBtn.textContent;

        submitBtn.textContent = "Đang kiểm tra...";
        submitBtn.disabled = true;

        setTimeout(() => {
            // 1. Tìm xem người dùng có tồn tại trong danh sách thô (mockDatabase) không?
            const userFound = mockDatabase.find(user => {
                return user.name.toLowerCase() === userInfo.name.toLowerCase() &&
                    user.role === userInfo.role &&
                    user.birthday === userInfo.birthday;
            });

            if (userFound) {
                // --- BƯỚC 1: XÁC ĐỊNH NỘI DUNG (CONTENT) ---
                let targetContent = null; // Mặc định là NULL (chưa tìm thấy)

                // Kiểm tra xem có nội dung riêng (ảnh, nhạc) không?
                if (contentDatabase[userInfo.name]) {
                    targetContent = contentDatabase[userInfo.name];
                } else if (contentDatabase[userInfo.role]) {
                    targetContent = contentDatabase[userInfo.role];
                } else if (userInfo.role === "brother_stress" || userInfo.role === "Blood brother") {
                    targetContent = contentDatabase["brother_village"];
                }

                // --- BƯỚC 2: XỬ LÝ ẢNH & AVATAR ---
                if (targetContent) {
                    // TRƯỜNG HỢP: NGƯỜI QUEN (Có trong contentDatabase)
                    currentImages = targetContent.images;

                    // Avatar & QR riêng (nếu có)
                    if (targetContent.avatar) document.getElementById('final-avatar').src = targetContent.avatar;
                    if (targetContent.qr) document.getElementById('final-qr').src = targetContent.qr;

                    // Nhạc riêng
                    if (targetContent.music) {
                        const musicEl = document.getElementById('bg-music');
                        musicEl.src = targetContent.music;
                        musicEl.loop = false;
                        musicEl.load();
                        if (playing) musicEl.play().catch(e => { });
                    }

                } else {
                    // TRƯỜNG HỢP: NGƯỜI LẠ / CHƯA CÓ DỮ LIỆU ẢNH
                    // 1. Không hiện ảnh kỷ niệm (Mảng rỗng)
                    currentImages = [];

                    // 2. Avatar là Ông Thần Tài
                    document.getElementById('final-avatar').src = "https://cdn-icons-png.flaticon.com/512/4305/4305542.png";

                    // 3. QR Code (Vẫn hiện để nhận lì xì)
                    document.getElementById('final-qr').src = "Image/grandfather/QR.png"; 

                    // 4. Nhạc mặc định (Nhạc Tết chung)
                    const musicEl = document.getElementById('bg-music');
                    musicEl.src = "Music/tetbinhan.mp3";
                    musicEl.load();
                    if (playing) musicEl.play().catch(e => { });
                }

                // --- BƯỚC 3: XỬ LÝ LỜI CHÚC (Logic vẫn giữ nguyên sự thông minh + GENDER) ---
                const parts = userInfo.birthday.split('/');
                const birthYear = parseInt(parts[2], 10);
                const age = new Date().getFullYear() - birthYear;
                const shortName = userFound.name.trim().split(' ').pop();

                let finalWish = "";

                // ƯU TIÊN 1: Lời chúc riêng (nếu có trong brothersInVillage)
                if (brothersInVillage[shortName]) {
                    finalWish = brothersInVillage[shortName];
                }
                // ƯU TIÊN 2: Lời chúc theo Template (nếu là Mẹ/Ông...)
                else if (targetContent && targetContent.wishTemplate) {
                    finalWish = targetContent.wishTemplate.replace("{name}", shortName).replace("{age}", age);
                }
                // ƯU TIÊN 3: Lời chúc tự động theo tuổi (Dành cho người lạ/người chưa có tên)
                else {
                    // THÊM USERINFO.GENDER VÀO ĐÂY
                    finalWish = getWish(shortName, age, userFound.vaive, userInfo.gender);
                }

                const wishContainer = document.getElementById('personal-wishes');
                if (wishContainer) wishContainer.textContent = finalWish;

                // --- BƯỚC 4: CHUYỂN MÀN HÌNH ---
                inputFormScreen.style.opacity = 0;
                setTimeout(() => {
                    inputFormScreen.style.display = 'none';

                    // Nếu không có ảnh (currentImages rỗng), ta bỏ qua slideshow và vào thẳng Final Screen
                    if (currentImages.length === 0) {
                        transitionScreen.style.display = 'none'; // Bỏ qua intro text
                        showFinalScreen(); // Vào thẳng màn hình lì xì
                    } else {
                        showTransitionScreen(); // Nếu có ảnh thì chạy bình thường
                    }
                }, 500);

            } else {
                // Nhập sai thông tin
                generalError.innerHTML = "Không tìm thấy thông tin trùng khớp.<br>Vui lòng kiểm tra lại Tên và Ngày sinh.";
                generalError.style.display = 'block';
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }, 1000);
    }

    const mockDatabase = [
        { name: "Nguyễn Thị Vui", role: "Mother", birthday: "19/01/1981" },
        { name: "Ưng Kiều Trang", role: "elder sister", birthday: "19/08/2004" },
        { name: "Lê Thanh Kiếm", role: "Grandfather", birthday: "01/03/1972" },
        { name: "Lê Đức Anh", role: "Blood brother", birthday: "15/08/2007" },
        { name: "Lê Bình An", role: "brother_stress", birthday: "07/01/2006" },
        { name: "Nguyễn Gia Huy", role: "brother_stress", birthday: "07/12/2006" },
        { name: "Lê Hoàng Hải", role: "brother_stress", birthday: "09/11/2006", vaive: "Thap" },
        { name: "Nguyễn Quang Huy", role: "brother_stress", birthday: "11/02/2007" },
        { name: "Hoàng Tiến Tùng", role: "brother_stress", birthday: "30/08/2006" },
        { name: "Lê Đức Anh", role: "brother_stress", birthday: "15/08/2007" },
        { name: "Nguyễn Việt Hoàng", role: "brother_stress", birthday: "05/11/2008" },
        { name: "Lê Trí Hiển", role: "brother", birthday: "22/07/2006" },
        { name: "Vũ Minh Đức", role: "brother", birthday: "11/09/2006" },
        { name: "Nguyễn Mai Nhật Anh", role: "brother", birthday: "24/05/2006" },
        { name: "Nguyễn Tuấn Hưng", role: "brother", birthday: "12/06/2006" },
    ];

    // --- 2. BIẾN TOÀN CỤC & INIT ---
    let currentImages = [];
    let isMobile = window.innerWidth < 768;
    let hasStarted = false; // Biến kiểm tra xem đã bắt đầu chưa

    // Thêm trường gender vào userInfo
    let userInfo = { name: '', role: '', birthday: '', gender: '' };

    window.addEventListener('resize', () => {
        isMobile = window.innerWidth < 768;
        if (canvas) { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    });

    const countdownEl = document.getElementById('countdown');
    const countdownScreen = document.getElementById('countdown-screen');
    const fireworksScreen = document.getElementById('fireworks-screen');
    const introEnvelopeScreen = document.getElementById('intro-envelope-screen');
    const introEnvelope = document.getElementById('intro-envelope');
    const introInst = document.getElementById('intro-inst');
    const inputFormScreen = document.getElementById('input-form-screen');
    const transitionScreen = document.getElementById('transition-screen');
    const transitionText = document.getElementById('transition-text');
    const slideScreen = document.getElementById('slideshow-screen');
    const finalScreen = document.getElementById('final-screen');
    const centerStage = document.getElementById('center-stage');
    const globalParticles = document.getElementById('global-particles');
    const musicBtn = document.getElementById('music-toggle');

    let canvas, ctx;
    let fireworks = [];
    let particles = [];
    let animationId;
    let count = 10;
    let fwInterval;
    let playing = false;

    const vibrantColors = ['#FF0000', '#FFD700', '#00FF00', '#00FFFF', '#FF00FF', '#FFFFFF', '#FFA500', '#ADFF2F'];

    // --- 3. LOGIC KÍCH HOẠT ---

    function handleUserInteraction() {
        if (hasStarted) return;
        hasStarted = true;

        document.getElementById('start-hint').style.display = 'none';

        const bgMusic = document.getElementById('bg-music');
        if (bgMusic) {
            bgMusic.loop = false;
            bgMusic.play().then(() => {
                musicBtn.style.animation = 'spin 5s linear infinite';
                playing = true;
            }).catch(e => console.log("Không thể phát nhạc: ", e));
        }

        startCountdownProcess();
    }

    document.body.addEventListener('click', handleUserInteraction);
    document.body.addEventListener('touchstart', handleUserInteraction);

    function startCountdownProcess() {
        const timer = setInterval(() => {
            count--;
            countdownEl.classList.add('flip-digit');
            setTimeout(() => countdownEl.classList.remove('flip-digit'), 500);
            countdownEl.textContent = count;

            let intensity = (10 - count) * (isMobile ? 2 : 3);
            spawnManyFireworks(Math.max(3, intensity));

            if (count <= 5) {
                clearInterval(fwInterval);
                fwInterval = setInterval(() => spawnManyFireworks(isMobile ? 3 : 5), 400);
                countdownScreen.classList.add('screen-shake');
                if (count <= 3) {
                    countdownEl.classList.add('critical-count');
                    spawnManyFireworks(isMobile ? 8 : 15);
                    const tickSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3');
                    tickSound.volume = 0.3; tickSound.play().catch(() => { });
                }
            }

            if (count <= 0) {
                clearInterval(timer); clearInterval(fwInterval);
                countdownEl.textContent = "2026"; countdownEl.style.fontSize = "22vw";
                spawnManyFireworks(isMobile ? 30 : 60);
                countdownScreen.classList.remove('screen-shake');
                setTimeout(() => {
                    countdownScreen.style.opacity = 0;
                    setTimeout(() => { countdownScreen.style.display = 'none'; startFireworksDisplay(); }, 1000);
                }, 2500);
            }
        }, 1000);
        fwInterval = setInterval(() => spawnManyFireworks(isMobile ? 2 : 3), 600);
    }

    /* --- 4. HỆ THỐNG PHÁO HOA --- */
    function startFireworksDisplay() {
        fireworksScreen.style.display = 'block';
        canvas = document.getElementById('fireworks-canvas');
        ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        startFireworks();
        setTimeout(() => { document.querySelector('.fireworks-text').style.opacity = 1; }, 500);
        setTimeout(() => {
            stopFireworks();
            fireworksScreen.style.opacity = 0;
            setTimeout(() => { fireworksScreen.style.display = 'none'; showIntroEnvelope(); }, 1000);
        }, 8000); // Rút ngắn thời gian intro để test nhanh hơn
    }

    function startFireworks() {
        function createFirework() {
            const color = vibrantColors[Math.floor(Math.random() * vibrantColors.length)];
            fireworks.push({
                x: Math.random() * canvas.width, y: canvas.height,
                targetX: Math.random() * canvas.width, targetY: Math.random() * (canvas.height / 2),
                speed: 3 + Math.random() * 3, color: color, radius: 3, exploded: false, trailLength: 25 + Math.random() * 20
            });
        }
        function draw() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.15)'; ctx.fillRect(0, 0, canvas.width, canvas.height);
            if (Math.random() < 0.1) createFirework();
            for (let i = fireworks.length - 1; i >= 0; i--) {
                const fw = fireworks[i];
                if (!fw.exploded) {
                    fw.x += (fw.targetX - fw.x) * 0.02; fw.y -= fw.speed;
                    for (let j = 0; j < fw.trailLength; j++) {
                        const alpha = 1 - (j / fw.trailLength);
                        ctx.beginPath(); ctx.arc(fw.x, fw.y + j * 2, fw.radius * (1 - j / fw.trailLength), 0, Math.PI * 2);
                        ctx.fillStyle = hexToRgba(fw.color, alpha * 0.6); ctx.fill();
                    }
                    ctx.beginPath(); ctx.arc(fw.x, fw.y, fw.radius, 0, Math.PI * 2);
                    ctx.fillStyle = fw.color; ctx.fill(); ctx.shadowBlur = 10; ctx.shadowColor = fw.color;
                    if (fw.y <= fw.targetY) { fw.exploded = true; ctx.shadowBlur = 0; explodeFirework(fw); }
                }
            }
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.vx; p.y += p.vy; p.vy += p.gravity; p.alpha -= 0.006;
                ctx.beginPath(); ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                ctx.fillStyle = hexToRgba(p.color, p.alpha); ctx.fill();
                if (Math.random() > 0.8) {
                    ctx.beginPath(); ctx.arc(p.x, p.y, p.radius * 2, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(255, 255, 255, ${p.alpha * 0.5})`; ctx.fill();
                }
                if (p.alpha <= 0) particles.splice(i, 1);
            }
            for (let i = fireworks.length - 1; i >= 0; i--) { if (fireworks[i].exploded) fireworks.splice(i, 1); }
            animationId = requestAnimationFrame(draw);
        }
        draw();
    }

    function hexToRgba(hex, alpha) {
        let r = parseInt(hex.slice(1, 3), 16), g = parseInt(hex.slice(3, 5), 16), b = parseInt(hex.slice(5, 7), 16);
        return `rgba(${r}, ${g}, ${b}, ${alpha})`;
    }
    function explodeFirework(fw) {
        const particleCount = 120 + Math.random() * 100;
        for (let tier = 0; tier < 3; tier++) {
            setTimeout(() => {
                for (let i = 0; i < particleCount / 3; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = (tier + 1) * (1.5 + Math.random() * 4);
                    particles.push({
                        x: fw.x, y: fw.y, vx: Math.cos(angle) * speed, vy: Math.sin(angle) * speed,
                        gravity: 0.04 + tier * 0.01, alpha: 1, radius: 1 + Math.random() * 2, color: fw.color
                    });
                }
            }, tier * 80);
        }
    }
    function stopFireworks() { cancelAnimationFrame(animationId); fireworks = []; particles = []; }

    /* --- 5. LOGIC LÌ XÌ INTRO --- */
    function showIntroEnvelope() {
        introEnvelopeScreen.style.display = 'flex';
        setTimeout(() => { introEnvelopeScreen.style.opacity = 1; }, 50);
        setTimeout(() => {
            spawnFireworkBurst(window.innerWidth / 2, window.innerHeight, isMobile ? 10 : 20, ['#FF0000', '#FFD700']);
            introEnvelope.classList.add('visible');
            setTimeout(() => { document.getElementById('intro-inst').classList.add('show'); }, 1200);
        }, 300);

        introEnvelope.addEventListener('click', function (e) {
            e.stopPropagation();
            if (this.classList.contains('open')) return;
            this.classList.add('open');
            const openAudio = document.getElementById('open-sound');
            if (openAudio) openAudio.play().catch(e => { });
            spawnSpecificBurst(window.innerWidth / 2, window.innerHeight / 2, 30, ['#FFD700', '#FF0000'], 'coin');
            setTimeout(() => {
                introEnvelopeScreen.style.opacity = 0;
                setTimeout(() => { introEnvelopeScreen.style.display = 'none'; showInputForm(); }, 800);
            }, 1000);
        }, { once: true });
    }

    /* --- 6. FORM NHẬP THÔNG TIN --- */
    function showInputForm() {
        inputFormScreen.style.display = 'flex';
        setTimeout(() => inputFormScreen.style.opacity = 1, 100);
        document.getElementById('submit-info').addEventListener('click', function (e) {
            e.stopPropagation();
            validateForm();
        });
        document.addEventListener('keypress', function (e) { if (e.key === 'Enter') validateForm(); });
    }

    // --- HÀM VALIDATE FORM ĐƯỢC THÊM MỚI ---
    function validateForm() {
        const nameInput = document.getElementById('user-name');
        const roleInput = document.getElementById('user-role');
        const birthdayInput = document.getElementById('user-birthday');
        const genderInput = document.getElementById('user-gender'); // Mới

        const name = nameInput.value.trim();
        const role = roleInput.value;
        const birthday = birthdayInput.value.trim();
        const gender = genderInput.value; // Mới

        let isValid = true;

        // Reset errors
        document.getElementById('name-error').style.display = 'none';
        document.getElementById('role-error').style.display = 'none';
        document.getElementById('birthday-error').style.display = 'none';
        document.getElementById('general-error').style.display = 'none';
        document.getElementById('gender-error').style.display = 'none'; // Mới

        if (name === "") {
            document.getElementById('name-error').style.display = 'block';
            isValid = false;
        }
        if (role === "") {
            document.getElementById('role-error').style.display = 'block';
            isValid = false;
        }
        if (gender === "") {
            document.getElementById('gender-error').style.display = 'block';
            isValid = false;
        }
        // Simple date regex for dd/mm/yyyy
        const dateRegex = /^(0[1-9]|[12][0-9]|3[01])\/(0[1-9]|1[012])\/(19|20)\d\d$/;
        if (!dateRegex.test(birthday)) {
            document.getElementById('birthday-error').style.display = 'block';
            isValid = false;
        }

        if (isValid) {
            userInfo = { name, role, birthday, gender };
            checkUserInDatabase();
        }
    }

    /* --- 7. TRANSITION (PHIÊN BẢN FINAL: 3 CẤP ĐỘ) --- */
    function showTransitionScreen() {
        transitionScreen.style.display = 'flex';
        transitionText.style.opacity = 1;
        transitionText.innerHTML = '';

        const currentYear = new Date().getFullYear();
        let line1Text = "";

        // --- CẤU HÌNH ROLE (QUAN TRỌNG) ---
        // 1. Nhóm Làng (Đường A)
        const villageRoles = ["brother_stress", "Blood brother", "brother_village"];

        // 2. Nhóm Đại học
        const uniRoles = ["brother_school", "university", "classmate"];

        // 3. Nhóm VIP (Trùng cả 2 hoặc đặc biệt thân)
        const vipRoles = ["brother_vip", "best_friend"];


        // --- XỬ LÝ LOGIC ---

        // ƯU TIÊN 1: Kiểm tra VIP trước
        if (vipRoles.includes(userInfo.role)) {
            // Tìm năm sinh nhỏ nhất của cả hội VIP
            const groupMembers = mockDatabase.filter(user => vipRoles.includes(user.role));
            const years = groupMembers.map(user => parseInt(user.birthday.split('/')[2]));
            const oldestYear = years.length > 0 ? Math.min(...years) : 2006;

            line1Text = `Hành trình AE cốt cán (Làng & ĐH) ${oldestYear} ➝ ${currentYear}`;
        }
        // ƯU TIÊN 2: Nhóm Làng
        else if (villageRoles.includes(userInfo.role)) {
            const groupMembers = mockDatabase.filter(user => villageRoles.includes(user.role));
            const years = groupMembers.map(user => parseInt(user.birthday.split('/')[2]));
            const oldestYear = years.length > 0 ? Math.min(...years) : 2000;

            line1Text = `Cùng nhìn lại kỉ niệm ae đường A ${oldestYear} ➝ ${currentYear}`;
        }
        // ƯU TIÊN 3: Nhóm Đại học
        else if (uniRoles.includes(userInfo.role)) {
            const groupMembers = mockDatabase.filter(user => uniRoles.includes(user.role));
            const years = groupMembers.map(user => parseInt(user.birthday.split('/')[2]));
            const oldestYear = years.length > 0 ? Math.min(...years) : 2002;

            line1Text = `Hồi ức thanh xuân đại học ${oldestYear} ➝ ${currentYear}`;
        }
        // MẶC ĐỊNH: Gia đình (Mẹ, Ông...)
        else {
            const parts = userInfo.birthday.split('/');
            const birthYear = parts[2];
            line1Text = `Những bức ảnh kỉ niệm: ${birthYear} ➝ ${currentYear}`;
        }

        const line2Text = userInfo.name;

        // --- HIỆU ỨNG GÕ CHỮ (KHÔNG ĐỔI) ---
        transitionText.innerHTML = '<div id="type-line-1" style="display:inline-block"></div><br><div id="type-line-2" style="color: white; font-size: 0.8em; margin-top: 10px; display:inline-block"></div><span class="cursor"></span>';
        const elLine1 = document.getElementById('type-line-1');
        const elLine2 = document.getElementById('type-line-2');

        let i = 0;
        function typeLine1() {
            if (i < line1Text.length) { elLine1.textContent += line1Text.charAt(i); i++; setTimeout(typeLine1, 50); }
            else {
                setTimeout(() => {
                    let j = 0;
                    function typeLine2() {
                        if (j < line2Text.length) { elLine2.textContent += line2Text.charAt(j); j++; setTimeout(typeLine2, 50); }
                        else {
                            document.querySelector('.cursor').style.display = 'none';
                            setTimeout(() => {
                                transitionText.style.transition = 'opacity 1s ease'; transitionText.style.opacity = 0;
                                setTimeout(() => { transitionScreen.style.display = 'none'; startSlideshow(); }, 1000);
                            }, 2000);
                        }
                    } typeLine2();
                }, 300);
            }
        } typeLine1();
    }

    /* --- 8. SLIDESHOW --- */
    let currentIdx = 0;
    const slideContainer = document.getElementById('slide-container');
    const slideCaption = document.getElementById('slide-caption');

    function startSlideshow() {
        clearInterval(fwInterval);
        slideScreen.style.display = 'flex';
        showNextImage();
    }

    function showNextImage() {
        if (currentIdx >= currentImages.length) {
            setTimeout(showFinalScreen, 1000);
            return;
        }
        const data = currentImages[currentIdx];
        const img = document.createElement('img');
        img.src = data.url; img.className = 'slide-img';
        slideContainer.appendChild(img);

        setTimeout(() => {
            img.classList.add('active');
            slideCaption.textContent = data.caption; slideCaption.style.opacity = 1;
            spawnFireworkBurst(window.innerWidth / 2, window.innerHeight / 2, isMobile ? 5 : 10, ['#FFD700']);
        }, 100);

        setTimeout(() => {
            img.classList.remove('active'); slideCaption.style.opacity = 0;
            setTimeout(() => { img.remove(); currentIdx++; showNextImage(); }, 1500);
        }, 2500);
    }

    /* --- 9. FINAL SCREEN --- */
    function showFinalScreen() {
        slideScreen.style.display = 'none';
        finalScreen.style.display = 'block';
        setTimeout(() => { document.getElementById('final-envelope-container').classList.add('show'); }, 500);

        const total = currentImages.length;
        const radiusX = isMobile ? window.innerWidth * 0.45 : 500;
        const radiusY = isMobile ? 80 : 150;
        const angleStep = (2 * Math.PI) / total;
        let baseAngle = 0;
        const satellites = [];

        const oldSats = document.querySelectorAll('.satellite-item');
        oldSats.forEach(el => el.remove());

        currentImages.forEach((data, i) => {
            const div = document.createElement('div');
            div.className = 'satellite-item';
            div.innerHTML = `<img src="${data.url}" alt="Ky niem">`;
            const sizeW = isMobile ? 100 : 160;
            div.style.width = sizeW + 'px';
            div.style.height = sizeW + 'px';
            div.style.marginLeft = (-sizeW / 2) + 'px';
            div.style.marginTop = (-sizeW / 2) + 'px';
            centerStage.appendChild(div);
            satellites.push({ el: div, index: i, angleOffset: i * angleStep });
        });

        function animateSatellites() {
            baseAngle += 0.002;
            satellites.forEach(sat => {
                const currentAngle = baseAngle + sat.angleOffset;
                const x = Math.cos(currentAngle) * radiusX;
                const y = Math.sin(currentAngle) * radiusY;
                const scaleFactor = 0.7 + ((y + radiusY) / (2 * radiusY)) * 0.6;
                const opacity = 0.5 + (scaleFactor - 0.7) * 1.5;
                const zIndex = Math.floor(y + 200);

                sat.el.style.transform = `translate(${x}px, ${y}px) scale(${scaleFactor})`;
                sat.el.style.zIndex = zIndex;
                sat.el.style.opacity = Math.min(1, Math.max(0.4, opacity));
                sat.el.style.filter = y < -20 ? 'blur(2px)' : 'none';
            });
            requestAnimationFrame(animateSatellites);
        }

        requestAnimationFrame(animateSatellites);
        setInterval(() => spawnManyFireworks(Math.random() * (isMobile ? 1 : 2) + 1), 3000);
    }

    /* --- 10. XỬ LÝ LÌ XÌ FINAL & MƯA TIỀN --- */
    const envelope = document.getElementById('final-envelope');
    const modal = document.getElementById('red-envelope-screen');
    const burstSound = document.getElementById('burst-sound');
    let dustInterval;

    function startMoneyRain() {
        const duration = 5000;
        const interval = 100;
        const rainInterval = setInterval(() => {
            createFallingMoney(Math.random() > 0.5 ? 'bill' : 'coin');
            setTimeout(() => createFallingMoney(Math.random() > 0.5 ? 'bill' : 'coin'), 50);
        }, interval);
        setTimeout(() => { clearInterval(rainInterval); }, duration);
    }

    function createFallingMoney(type) {
        const el = document.createElement('div');
        el.classList.add('falling-money');
        el.classList.add(type === 'bill' ? 'money-bill' : 'money-coin');
        const startX = Math.random() * window.innerWidth;
        el.style.left = startX + 'px';
        const fallDuration = Math.random() * 3 + 2;
        el.style.animationDuration = fallDuration + 's';
        const scale = Math.random() * 0.5 + 0.5;
        el.style.transform = `scale(${scale})`;
        document.body.appendChild(el);
        setTimeout(() => { el.remove(); }, fallDuration * 1000);
    }

    envelope.addEventListener('click', (e) => {
        e.stopPropagation();
        if (envelope.classList.contains('open')) return;
        envelope.classList.add('open');
        const openAudio = document.getElementById('open-sound');
        if (openAudio) openAudio.play().catch(e => { });

        startMoneyRain();

        setTimeout(() => {
            if (burstSound) burstSound.play().catch(e => { });
            const coinCount = isMobile ? 30 : 60; const confettiCount = isMobile ? 50 : 100;
            spawnSpecificBurst(window.innerWidth / 2, window.innerHeight / 2, coinCount, ['#FFD700', '#FFA500'], 'coin');
            spawnSpecificBurst(window.innerWidth / 2, window.innerHeight / 2, confettiCount, ['#FF0000', '#FFFF00', '#FF4500'], 'confetti');

            setTimeout(() => {
                modal.style.display = 'flex';
                dustInterval = setInterval(createGoldDust, 200);
            }, 800);
        }, 600);
    });
    function closeModal() { modal.style.display = 'none'; clearInterval(dustInterval); envelope.classList.remove('open'); }

    /* --- 11. FIREWORKS UTILS --- */
    function spawnManyFireworks(n) {
        for (let i = 0; i < n; i++) { setTimeout(() => { spawnFireworkBurst(Math.random() * window.innerWidth, Math.random() * window.innerHeight * 0.7, Math.random() * 15 + 15, vibrantColors); }, Math.random() * 800); }
    }
    function spawnFireworkBurst(x, y, count, colors) { for (let i = 0; i < count; i++) createParticle(x, y, colors); }
    function createParticle(x, y, colors) {
        const p = document.createElement('div'); p.className = 'burst-particle';
        globalParticles.appendChild(p);
        const color = colors[Math.floor(Math.random() * colors.length)];
        const size = Math.random() * (isMobile ? 3 : 4) + 2; const angle = Math.random() * Math.PI * 2; const vel = Math.random() * 100 + 50;
        const tx = Math.cos(angle) * vel; const ty = Math.sin(angle) * vel + 100;
        p.style.left = x + 'px'; p.style.top = y + 'px'; p.style.width = size + 'px'; p.style.height = size + 'px';
        p.style.background = color; p.style.boxShadow = `0 0 ${size}px ${color}`;
        p.animate([{ transform: 'translate(0,0) scale(1)', opacity: 1 }, { transform: `translate(${tx}px, ${ty}px) scale(0)`, opacity: 0 }], { duration: Math.random() * 800 + 600, easing: 'cubic-bezier(0.25,1,0.5,1)' }).onfinish = () => p.remove();
    }
    function spawnSpecificBurst(x, y, count, colors, type) {
        for (let i = 0; i < count; i++) {
            const p = document.createElement('div'); p.className = 'burst-particle'; globalParticles.appendChild(p);
            const color = colors[Math.floor(Math.random() * colors.length)]; const size = Math.random() * 6 + 3;
            const angle = Math.random() * Math.PI * 2; const vel = Math.random() * 200 + 80;
            const tx = Math.cos(angle) * vel; const ty = Math.sin(angle) * vel + 250;
            p.style.left = x + 'px'; p.style.top = y + 'px'; p.style.width = size + 'px'; p.style.height = (type === 'coin' ? size : size * 1.5) + 'px';
            p.style.background = color; if (type === 'coin') { p.style.borderRadius = '50%'; p.style.border = '1px solid gold'; } else { p.style.borderRadius = '0'; }
            p.animate([{ transform: 'translate(0,0) rotate(0deg)', opacity: 1 }, { transform: `translate(${tx}px, ${ty}px) rotate(${Math.random() * 360}deg)`, opacity: 0 }], { duration: Math.random() * 1200 + 800, easing: 'ease-out' }).onfinish = () => p.remove();
        }
    }
    function createGoldDust() {
        const d = document.createElement('div'); d.className = 'gold-dust'; d.style.left = Math.random() * 100 + '%'; d.style.top = '-10px';
        document.getElementById('modal-particles').appendChild(d); setTimeout(() => d.remove(), 3000);
    }

    // Logic nút nhạc thủ công
    musicBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        const bg = document.getElementById('bg-music');
        if (playing) {
            bg.pause();
            musicBtn.style.animation = 'none';
        } else {
            bg.play();
            musicBtn.style.animation = 'spin 5s linear infinite';
        }
        playing = !playing;
    });
    </script>
</body>

</html>